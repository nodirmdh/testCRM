# Архитектура

## Общая схема
- Web frontend + Backend API + PostgreSQL.
- Для MVP - монолит.
- Multi-tenant через `organization_id` во всех доменных сущностях.

## Стек
- Backend: NestJS + TypeScript.
- ORM: Prisma.
- База данных: PostgreSQL.
- Auth: JWT access + refresh tokens.

## Компоненты
- Frontend: веб-интерфейс для owner и admin.
- Backend API: NestJS-монолит с модульной структурой.
- PostgreSQL: транзакционное хранилище.
- Storage: S3 или локальное хранилище для сертификатов.

## Модули
- Auth: пользователи, роли, сессии, токены.
- Academics: курсы, группы, зачисления.
- Attendance: занятия и посещаемость.
- Finance: счета, оплаты, доходы.
- Payroll: правила, начисления, выплаты.
- Certificates: выдача и учёт сертификатов.

## Ключевые потоки
- Начисление оплат: создание счетов по зачислениям.
- Оплата: частичные и полные платежи по счетам.
- Учёт дохода: агрегация оплат по периодам.
- Расчёт зарплат: по занятиям или % от дохода.
- Сертификат: генерация PDF по шаблону и выдача по защищенной ссылке.

## Контуры API
- CRUD для справочников и ключевых сущностей.
- Эндпоинты для операций: зачисление, отметка посещаемости, оплата, начисление зарплат.
- Отчёты: базовые агрегированные метрики.

## Безопасность
- Аутентификация и разграничение по ролям.
- Изоляция данных между организациями.
- Валидация входных данных и журналирование ключевых операций.

## Масштабируемость
- Логическое разделение модулей внутри монолита.
- Возможность вынесения модулей в сервисы после MVP.
- Индексация по `organization_id` и ключевым датам.
